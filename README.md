# Lua Obfuscator
VM-based obfuscator for Lua 5.1

## Backlog
- [X] Shuffle constants
- [X] Shuffle prototypes
- [X] Update registers (instruction fields)
- [X] Generate virtual machine
	- [X] Serialize bytecode
	- [X] Apply VM template scripts
	- [X] Generate opcode mutations
	- [X] Generate opcode handlers

## Known Issues
- `getfenv()` and `setfenv()` are still linked to the original Lua VM instead of the custom VM generated by the obfuscator, so changes to the Lua environment are not reflected at runtime.
- There are some issues with upvalue semantics, namely when the upvalue registers are updated after being passed to global functions.

## Resources
- Most of the enums were ripped from the [Lua 5.1 source code](https://www.lua.org/source/5.1/), along with the format of some of the VM instructions.
- Kein-Hong Man's [A No-Frills Introduction to Lua 5.1 VM Instructions](https://www.mcours.net/cours/pdf/hasclic3/hasssclic818.pdf) was extremely helpful in detailing much of the Lua VM's inner workings.

Also check out my other repo [luac-viewer](https://github.com/Nobody4931/luac-viewer), which was very helpful in disassembling compiled Lua programs, and also the predecessor to this project!
